<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Model &gt; Estimate &gt; Linear regression (OLS)</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">

/* padding for bootstrap navbar */
body {
  padding-top: 50px;
  padding-bottom: 40px;
}

/* offset scroll position for anchor links (for fixed navbar)  */
.section h2 {
  padding-top: 55px;
  margin-top: -55px;
}
.section h3 {
  padding-top: 55px;
  margin-top: -55px;
}

/* don't use link color in navbar */
.dropdown-menu>li>a {
	display: inline;
  color: black;
  padding-top: 0;
  padding-bottom: 0;
}

.dropdown-menu .divider {
	margin-top: 2px;
	margin-bottom: 2px;
}

img {
  max-width: 85% !important;
}

/*
img.center {
  display: block;
  margin: 0 auto;
}
*/

</style>

<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>
<link rel="shortcut icon" type="image/png" href="/docs/images/radiant_red.png"/>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/radiant-rstats/docs">Radiant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/docs/index.html">Home</a></li>
        <li><a href="/docs/news.html">News</a></li>
        <li><a href="/docs/install.html">Install</a></li>
        <li class="dropdown">
          <a href="/docs/data/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Data<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li><a href="/docs/data/manage.html">Manage</a></li>
             <li><a href="/docs/data/view.html">View</a></li>
             <li><a href="/docs/data/visualize.html">Visualize</a></li>
             <li><a href="/docs/data/pivotr.html">Pivot</a></li>
             <li><a href="/docs/data/explore.html">Explore</a></li>
             <li><a href="/docs/data/transform.html">Transform</a></li>
             <li><a href="/docs/data/combine.html">Combine</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="/docs/design/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Design<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">DOE</li>
             <li><a href="/docs/design/doe.html">Design of Experiments (DOE)</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Sample</li>
             <li><a href="/docs/design/sampling.html">Random sampling</a></li>
             <li><a href="/docs/design/sample_size.html">Sample size (single)</a></li>
             <li><a href="/docs/design/sample_size_comp.html">Sample size (compare)</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="/docs/basics/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Basics<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">Probability</li>
             <li><a href="/docs/basics/prob_calc.html">Probability calculator</a></li>
             <li><a href="/docs/basics/clt.html">Central Limit Theorem</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Means</li>
             <li><a href="/docs/basics/single_mean.html">Single mean</a></li>
             <li><a href="/docs/basics/compare_means.html">Compare means</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Proportions</li>
             <li><a href="/docs/basics/single_prop.html">Single proportion</a></li>
             <li><a href="/docs/basics/compare_props.html">Compare proportions</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Tables</li>
             <li><a href="/docs/basics/goodness.html">Goodness of fit</a></li>
             <li><a href="/docs/basics/cross_tabs.html">Cross-tabs</a></li>
             <li><a href="/docs/basics/correlation.html">Correlation</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="/docs/model/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Model<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">Estimate</li>
             <li><a href="/docs/model/regress.html">Linear regression (OLS)</a></li>
             <li><a href="/docs/model/logistic.html">Logistic regression (GLM)</a></li>
             <li><a href="/docs/model/nn.html">Neural Network</a></li>
             <li><a href="/docs/model/nb.html">Naive Bayes</a></li>
             <li><a href="/docs/model/crtree.html">Classification and regression trees</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Evaluate</li>
             <li><a href="/docs/model/evalreg.html">Evaluate regression</a></li>
             <li><a href="/docs/model/evalbin.html">Evaluate classification</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Recommend</li>
             <li><a href="/docs/model/crs.html">Collaborative Filtering</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Decide</li>
             <li><a href="/docs/model/dtree.html">Decision analysis</a></li>
             <li><a href="/docs/model/simulater.html">Simulate</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="/docs/multivariate/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Multivariate<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">Maps</li>
             <li><a href="/docs/multivariate/mds.html">(Dis)similarity</a></li>
             <li><a href="/docs/multivariate/prmap.html">Attributes</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Factor</li>
             <li><a href="/docs/multivariate/pre_factor.html">Pre-factor</a></li>
             <li><a href="/docs/multivariate/full_factor.html">Factor</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Cluster</li>
             <li><a href="/docs/multivariate/hclus.html">Hierarchical</a></li>
             <li><a href="/docs/multivariate/kclus.html">K-clustering</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Conjoint</li>
             <li><a href="/docs/multivariate/conjoint.html">Conjoint</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="/docs/R/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">R<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li><a href="/docs/data/report_rmd.html">Report > Rmd</a></li>
             <li><a href="/docs/data/report_r.html">Report > R</a></li>
             <li><a href="/docs/programming.html">Programming</a></li>
             <li><a href="/docs/resources.html">Resources</a></li>
          </ul>
        </li>
        <li><a href="/docs/tutorials.html">Tutorials</a></li>
        <li><a href="/docs/about.html">About</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Model &gt; Estimate &gt; Linear regression (OLS)</h1>

</div>


<hr />
<blockquote>
<p>(Linear) Regression: The workhorse of empirical research in the social sciences</p>
</blockquote>
<p>All example files discussed below can be loaded from the Data &gt; Manage page. Click the <code>examples</code> radio button and press <code>Load</code>.</p>
<div id="functionality" class="section level3">
<h3>Functionality</h3>
<p>Start by selecting a response variable and one or more explanatory variables. If two or more explanatory variables are included in the model we may want to investigate if any interactions are present. An interaction exists when the effect of an explanatory variable on the response variable is determined, at least partially, by the level of another explanatory variable. For example, the increase in price for a 1 versus a 2 carrot diamond may depend on the clarity level of the diamond.</p>
<p>In the <em>Summary</em> tab we can test if two or more variables together add significantly to the fit of a model by selecting variables in the <code>Variables to test</code> dropdown. This functionality can be very useful to test if the overall influence of a variable of type <code>factor</code> is significant.</p>
<p>Additional output that requires re-estimation:</p>
<ul>
<li>Standardize: Coefficients can be hard to compare if the explanatory variables are measured on different scales. By standardizing the data before estimation we can see which variables move-the-needle most. Note that a one-unit change is now equated to 2 x the standard deviation of the variable</li>
<li>Center: Replace all explanatory variables X by X - mean(X). This can be useful when trying to interpret interaction effects</li>
<li>Stepwise: A data-mining approach to select the best fitting model</li>
<li>Robust standard errors: When <code>robust</code> is selected the coefficient estimates are the same as OLS. However, standard errors are adjusted to account for (minor) heterogeneity and non-normality concerns.</li>
</ul>
<p>Additional output that does not require re-estimation:</p>
<ul>
<li>RMSE: Root Mean Squared Error and Residual Standard Deviation</li>
<li>Sum of Squares: The total variance in the response variable split into the variance explained by the Regression and the variance that is left unexplained (i.e., Error)</li>
<li>VIF: Variance Inflation Factors and Rsq. These are measures of multi-collinearity among the explanatory variables</li>
<li>Confidence intervals: Coefficient confidence intervals</li>
</ul>
<p>The <em>Predict</em> tab allows you calculate predicted values from a regression model. You can choose to predict responses for a dataset (i.e., select <code>Data</code> from the <code>Prediction input</code> dropdown), based on a command (i.e., select <code>Command</code> from the <code>Prediction input</code> dropdown), or a combination of the two (i.e., select <code>Data &amp; Command</code> from the <code>Prediction input</code> dropdown).</p>
<p>If you choose <code>Command</code> you must specify at least one variable and value to get a prediction. If you do not specify a value for each variable in the model, either the mean value or the most frequent level will be used. It is only possible to predict outcomes based on variables in the model (e.g., <code>carat</code> must be one of the selected explanatory variables to predict the <code>price</code> of a 2-carat diamond).</p>
<ul>
<li>To predict the price of a 1-carat diamond type <code>carat = 1</code> and press return</li>
<li>To predict the price of diamonds ranging from .5 to 1 carat at steps of size .05 type <code>carat = seq(.5,.1,.05)</code> and press return</li>
<li>To predict the price of 1,2, or 3 carat diamonds with an ideal cut type <code>carat = 1:3, cut = &quot;Ideal&quot;</code> and press return</li>
</ul>
<p>The <em>Plot</em> tab is used to provide basic visualizations of the data as well as diagnostic plots to validate the regression model.</p>
</div>
<div id="example-1-catalog-sales" class="section level3">
<h3>Example 1: Catalog sales</h3>
<p>We have access to data from a company selling men’s and women’s apparel through mail-order catalogs (dataset <code>catalog</code>). The company maintains a database on past and current customers’ value and characteristics. Value is determined as the total $ sales to the customer in the last year. The data are a random sample of 200 customers from the company’s database and has the following 4 variables</p>
<ul>
<li>Sales = Total sales (in $) to a household in the past year</li>
<li>Income = Household income ($1000)</li>
<li>HH.size = Size of the household (# of people)</li>
<li>Age = Age of the head of the household</li>
</ul>
<p>The catalog company is interested in redesigning their Customer Relationship Management (CRM) strategy. We will proceed in two steps:</p>
<ol style="list-style-type: decimal">
<li>Estimate a regression model using last year’s sales total. Response variable: sales total for each of the 200 households; Explanatory variables: household income (measured in thousands of dollars), size of household, and age of the household head. To access this dataset go to <em>Data &gt; Manage</em>, select <code>examples</code> from the <code>Load data of type</code> dropdown, and press the <code>Load</code> button. Then select the <code>catalog</code> dataset.</li>
<li>Interpret each of the estimated coefficients. Also provide a statistical evaluation of the model as a whole.</li>
<li>Which explanatory variables are significant predictors of customer value (use a 95% confidence level)?</li>
</ol>
<p><strong>Answer:</strong></p>
<p>Select the relevant variables mentioned above and press the <code>Estimate model</code> button or press <code>CTRL-enter</code> (<code>CMD-enter</code> on mac). Output from <em>Model &gt; Linear regression (OLS)</em> is provided below:</p>
<p align="center">
<img src="figures_model/regress_catalog_summary.png">
</p>
<p>The null and alternate hypothesis for the F-test can be formulated as follows:</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: All regression coefficients are equal to 0</li>
<li><span class="math inline">\(H_a\)</span>: At least one regression coefficient is not equal to zero</li>
</ul>
<p>The F-statistic suggests that the regression model as a whole explains a significant amount of variance in <code>Sales</code>. The calculated F-statistic is equal to 32.33 and has a very small p.value (&lt; 0.001). The amount of variance in sales explained by the model is equal to 33.1% (see R-squared).</p>
<p>We can replicate the standard F-test that is reported as part of all regression output by selecting <code>income</code>, <code>HH.size</code>, and <code>Age</code> in the <code>Variables to test</code> box. The relevant output is shown below.</p>
<p><img src="figures_model/regress_catalog_F_test.png" alt="Regression 1 - F-test" width="400" /></p>
<p>Note that in this example, “model 1” is a regression without explanatory variables. As you might expect, the explained variance for model 1 is equal to zero. The F-test compares the <em>fit</em> of model 1 and model 2, adjusted for the difference in the number of coefficients estimated in each model. The test statistic to use is described below. <span class="math inline">\(R^2_2\)</span> is the explained variance for model 2 and <span class="math inline">\(R^2_1\)</span> is the explained variance for model 1. <span class="math inline">\(n\)</span> is equal to the number of rows in the data, and <span class="math inline">\(k_2\)</span> (<span class="math inline">\(k_1\)</span>) is equal to the number of estimated coefficients in model 2 (model 1).</p>
<p><span class="math display">\[
\begin{eqnarray}
  F &amp; = &amp; \frac{(R^2_2 - R^2_1)/(k_2 - k_1)}{(1 - R^2_2)/(n - k_2 - 1)} \\\\
    &amp; = &amp; \frac{(0.331 - 0)/(3 - 0)}{(1 - 0.331)/(200 - 3 - 1)} \\\\
    &amp; = &amp; 32.325
\end{eqnarray}
\]</span></p>
<p>We can use the provided p.value associated with an F-statistic of 32.325 to evaluate the null hypothesis. We can also calculate the critical F-statistic using the probability calculator. As we can see from the output below that value is 2.651. Because the provided p.value is &lt; 0.001 and the calculated F-statistic is larger than the critical value (32.325 &gt; 2.651) we reject null hypothesis that all coefficient are equal to zero.</p>
<p align="center">
<img src="figures_model/regress_catalog_F_critical.png">
</p>
<p>The coefficients from the regression can be interpreted as follows:</p>
<ul>
<li>For an increase in income of $1000 we expect, on average, to see an increase in sales of $1.7754, keeping all other variables in the model constant.</li>
<li>For an increase in household size of 1 person we expect, on average, to see an increase in sales of $22.1218, keeping all other variables in the model constant.</li>
<li>For an increase in the age of the head of the household of 1 year we expect, on average, to see an increase in sales of $0.45, keeping all other variables in the model constant.</li>
</ul>
<p>For each of the explanatory variables the following null and alternate hypotheses can be formulated:</p>
<ul>
<li>H0: The coefficient associated with explanatory variable x is equal to 0</li>
<li>Ha: The coefficient associated with explanatory variable x is not equal to 0</li>
</ul>
<p>The coefficients for <code>Income</code> and <code>HH.size</code> are both significant (p.values &lt; 0.05), i.e., we can reject H0 for each of these coefficients. The coefficient for <code>Age HH</code> is not significant (p.value &gt; 0.05), i.e., we cannot reject H0 for <code>Age HH</code>. We conclude that a change in Age of the household head does not lead to a significant change in sales.</p>
<p>We can also use the t.values to evaluate the null and alternative hypotheses for the coefficients. Because the calculated t.value for <code>Income</code> and <code>HH.size</code> is <strong>larger</strong> than the <em>critical</em> t.value we reject the null hypothesis for both effects. We can obtain the critical t.value by using the probability calculator in the <em>Basics</em> menu. For a t-distribution with 196 degrees of freedom (see the <code>Errors</code> line in the <code>Sum of Squares</code> table shown above) the critical t.value is 1.972. We have to enter 0.025 and 0.975 as the lower and upper probability bounds in the probability calculator because the alternative hypothesis is <code>two.sided</code>.</p>
<p align="center">
<img src="figures_model/regress_catalog_prob_calc.png">
</p>
<p><br></p>
</div>
<div id="example-2-ideal-data-for-regression" class="section level3">
<h3>Example 2: Ideal data for regression</h3>
<p>The data <code>ideal</code> contains simulated data that is very useful to demonstrate what data for, and residuals from, a regression should ideally look like. The data has 1,000 observations on 4 variables. <code>y</code> is the response variable and <code>x1</code>, <code>x2</code>, and <code>x3</code> are explanatory variables. The plots shown below can be used as a bench mark for regressions on real world data. We will use <em>Model &gt; Linear regression (OLS)</em> to conduct the analysis. First, go the the <em>Plots</em> tab and select <code>y</code> as the response variable and <code>x1</code>, <code>x2</code>, and <code>x3</code> as the explanatory variables.</p>
<p><code>y</code>, <code>x2</code>, and <code>x3</code> appear (roughly) normally distributed whereas <code>x1</code> appears (roughly) uniformly distributed. There are no indication of outliers or severely skewed distributions.</p>
<p align="center">
<img src="figures_model/regress_ideal_hist.png">
</p>
<p>In the plot of correlations there are clear associations among the response and explanatory variables as well as among the explanatory variables themselves. Note that in an experiment the x’s of interest would have a zero correlation. This is very unlikely in historical data however. The scatter plots in the lower-diagonal part of the plot show that the relationships between the variables are (approximately) linear.</p>
<p align="center">
<img src="figures_model/regress_ideal_corr.png">
</p>
<p>The scatter plots of <code>y</code> (the response variable) against each of the explanatory variables confirm the insight from the correlation plot. The line fitted through the scatter plots is sufficiently flexible that it would pickup any non-linearities. The lines are, however, very straight, suggesting that a linear model will likely be appropriate.</p>
<p align="center">
<img src="figures_model/regress_ideal_scatter.png">
</p>
<p>The dashboard of six residual plots looks excellent, as we might expect for these data. True values and predicted values from the regression form a straight line with random scatter, i.e., as the actual values of the response variable go up, so do the predicted values from the model. The residuals (i.e., the differences between the values of the response variable data and the values predicted by the regression) show no pattern and are randomly scattered around a horizontal line. Any pattern would suggest that the model is better (or worse) at predicting some parts of the data compared to others. If a pattern were visible in the Residual vs Row order plot we might be concerned about auto-correlation. Again, the residuals are nicely scattered about a horizontal axis. Note that auto-correlation is a problem we are really only concerned about when we have time-series data. The Q-Q plot shows a nice straight and diagonal line, evidence that the residuals are normally distributed. This conclusion is confirmed by the histogram of the residuals and the density plot of the residuals (green) versus the theoretical density of a normally distributed variable (blue line).</p>
<p align="center">
<img src="figures_model/regress_ideal_dashboard.png">
</p>
<p>The final diagnostic we will discuss is a set of plots of the residuals versus the explanatory variables (or predictors). There is no indication of any trends or heteroscedasticity. Any patterns in these plots would be cause for concern. There are also no outliers, i.e., points that are far from the main cloud of data points.</p>
<p align="center">
<img src="figures_model/regress_ideal_res_vs_pred.png">
</p>
<p>Since the diagnostics look good, we can draw inferences from the regression. First, the model is significant as a whole: the p.value on the F-statistic is less than 0.05 therefore we reject the null hypothesis that all three variables in the regression have slope equal to zero. Second, each variable is statistically significant. For example, the p.value on the t-statistic for <code>x1</code> is less than 0.05 therefore we reject the null hypothesis that <code>x1</code> has a slope equal to zero when <code>x2</code> and <code>x3</code> are also in the model (i.e., ‘holding all other variables in the model constant’).</p>
<p>Increases in <code>x1</code> and <code>x3</code> are associated with increases in <code>y</code> whereas increases in <code>x2</code> are associated with decreases in <code>y</code>. Since these are simulated data the exact interpretation of the coefficient is not very interesting. However, in the scatterplot it looks like increases in <code>x3</code> are associated with decreases in <code>y</code>. What explains the difference? Hint: consider the correlation plots.</p>
<p align="center">
<img src="figures_model/regress_ideal_summary.png">
</p>
<p><br></p>
</div>
<div id="example-3-linear-or-log-log-regression" class="section level3">
<h3>Example 3: Linear or log-log regression?</h3>
<p>Both linear and log-log regressions are commonly applied to business data. In this example we will look for evidence in the data and residuals that may suggest which model specification is appropriate for the available data.</p>
<p>The data <code>diamonds</code> contains information on prices of 3,000 diamonds. A more complete description of the data and variables is available from the <em>Data &gt; Manage</em> page. Select the variable <code>price</code> as the response variable and <code>carat</code> and <code>clarity</code> as the explanatory variables. Before looking at the parameter estimates from the regression go to the <em>Plots</em> tab to take a look at the data and residuals. Below are the histograms for the variables in the model. <code>Price</code> and <code>carat</code> seem skewed to the right. Note that the direction of skew is determined by where the <em>tail</em> is.</p>
<p align="center">
<img src="figures_model/regress_diamonds_hist.png">
</p>
<p>In the plot of correlations there are clear associations among the response and explanatory variables. The correlation between <code>price</code> and <code>carat</code> is very large (i.e., 0.93). The correlation between <code>carat</code> and <code>clarity</code> of the diamond is significant and negative.</p>
<p align="center">
<img src="figures_model/regress_diamonds_corr.png">
</p>
<p>The scatter plots of <code>price</code> (the response variable) against the explanatory variables are not as clean as for the <code>ideal</code> data in Example 2. The line fitted through the scatter plots is sufficiently flexible to pickup non-linearities. The line for <code>carat</code> seems to have some curvature and the points do not look randomly scattered around that line. In fact the points seem to fan-out for higher prices and number of carats. There does not seem to be very much movement in <code>price</code> for different levels of <code>clarity</code>. If anything, the price of the diamond seems to go down as clarity increase. A surprising result we will discuss in more detail below.</p>
<p align="center">
<img src="figures_model/regress_diamonds_scatter.png">
</p>
<p>The dashboard of six residual plots looks less than stellar. The true values and predicted values from the regression form an S-shaped curve. At higher actual and predicted values the spread of points around the line is wider, consistent with what we saw in the scatter plot of <code>price</code> versus <code>carat</code>. The residuals (i.e., the differences between the actual data and the values predicted by the regression) show an even more distinct pattern as they are clearly not randomly scattered around a horizontal axis. The Residual vs Row order plot looks perfectly straight indicating that auto-correlation is not a concern. Finally, while for the <code>ideal</code> data in Example 2 the Q-Q plot showed a nice straight diagonal line, here dots clearly separate from the line at the right extreme. Evidence that the residuals are not normally distributed. This conclusions is confirmed by the histogram and density plots of the residuals that show a more spiked appearance than a normally distributed variable would.</p>
<p align="center">
<img src="figures_model/regress_diamonds_dashboard.png">
</p>
<p>The final diagnostic we will discuss is a set of plots of the residuals versus the explanatory variables (or predictors). The residuals fan-out from left to right in the plot of residuals vs carats. The scatter plot of <code>clarity</code> versus residuals shows outliers with strong negative values for lower levels of <code>clarity</code> and outliers with strong positive values for diamonds with higher levels of <code>clarity</code>.</p>
<p align="center">
<img src="figures_model/regress_diamonds_res_vs_pred.png">
</p>
<p>Since the diagnostics do not look good, we should <strong>not</strong> draw inferences from this regression. A log-log specification may be preferable. A quick way to check the validity of a log-log model change is available through the <em>Data &gt; Visualize</em> tab. Select <code>price</code> as the Y-variable and <code>carat</code> as the X-variable in a <code>Scatter</code> plot. Check the <code>log X</code> and <code>log Y</code> boxes to produce the plot below. The relationship between log-price and log-carat looks close to linear. Exactly what we are looking for!</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_viz_scatter.png">
</p>
<p>We will apply a (natural) log (or <em>ln</em>) transformation to both <code>price</code> and <code>carat</code> and rerun the analysis to see if the log-log specification is more appropriate for the available data. This transformation can be done in <em>Data &gt; Transform</em>. Select the variables <code>price</code> and <code>carat</code>. Choose <code>Transform</code> from the <code>Transformation type</code> drop-down and choose <code>Ln (natural log)</code> from the <code>Apply function</code> drop-down. Make sure to click the <code>Store</code> button so the new variables are added to the dataset. Note that we cannot apply a log transformation to <code>clarity</code> because it is a <a href="http://en.wikipedia.org/wiki/Categorical_variable" target="_blank">categorical</a> variable.</p>
<p>In <em>Model &gt; Linear regression (OLS)</em> select the variable <code>price_ln</code> as the response variable and <code>carat_ln</code> and <code>clarity</code> as the explanatory variables. Before looking at the parameter estimates from the regression go to the <em>Plots</em> tab to take a look at the data and residuals. Below are the histograms for the variables in the model. Note that <code>price_ln</code> and <code>carat_ln</code> are not right skewed, a good sign.</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_hist.png">
</p>
<p>In the plot of correlations there are still clear associations among the response and explanatory variables. The correlation between <code>price_ln</code> and <code>carat_ln</code> is extremely large (i.e., .93). The correlation between <code>carat_ln</code> and <code>clarity</code> of the diamond is significant and negative.</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_corr.png">
</p>
<p>The scatter plots of <code>price_ln</code> (the response variable) against the explanatory variables are now much cleaner. The line through the scatter plot of <code>price_ln</code> versus <code>carat_ln</code> is (mostly) straight. Although the points do have a bit of a blocked shape around the line, the scattering seems mostly random. We no longer see the points fan-out for higher values of <code>price_ln</code> and <code>carat_ln</code>. There seems to be a bit more movement in <code>price_ln</code> for different levels of <code>clarity</code>. However, the <code>price_ln</code> of the diamond still goes down as <code>clarity</code> increases which is unexpected. We will discuss this result below.</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_scatter.png">
</p>
<p>The dashboard of six residual plots looks much better than for the linear model. The true values and predicted values from the regression (almost) form a straight line. Although at higher and lower actual and predicted values the line is perhaps still very slightly curved. The residuals are much closer to a random scatter around a horizontal line. The Residual vs Row order plot still looks perfectly straight indicating that auto-correlation is not a concern. Finally, the Q-Q plot shows a nice straight and diagonal line, just like we saw for the <code>ideal</code> data in Example 2. Evidence that the residuals are now normally distributed. This conclusion is confirmed by the histogram and density plot of the residuals.</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_dashboard.png">
</p>
<p>The final diagnostic we will discuss is a set of plots of the residuals versus the explanatory variables (or predictors). The residuals look much closer to random scatter around a horizontal line compared to the linear model. Although for low (high) values of <code>carat_ln</code> the residuals may be a bit higher (lower).</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_res_vs_pred.png">
</p>
<p>Since the diagnostics now look much better, we can feel more confident about drawing inferences from this regression. The regression results are available in the <em>Summary</em> tab. Note that we get 7 coefficients for the variable clarity compared to only one for <code>carat_ln</code>. How come? If you look at the data description (<em>Data &gt; Manage</em>) you will see that clarity is a categorical variables with levels that go from IF (worst clarity) to I1 (best clarity). Categorical variables must be converted to a set of dummy (or indicator) variables before we can apply numerical analysis tools like regression. Each dummy indicates if a particular diamond has a particular clarity level (=1) or not (=0). Interestingly, to capture all information in the 8-level clarity variable we only need 7 dummy variables. Note there is no dummy variable for the clarity level I1 because we don’t actually need it in the regression. When a diamond is <strong>not</strong> of clarity SI2, SI1, VS2, VS1, VVS2, VVS1 or IF we know that in our data it must be of clarity I1.</p>
<p>The F-statistic suggests that the regression model as a whole explains a significant amount of variance in <code>price_ln</code>. The F-statistic is very large and has a very small p.value (&lt; 0.001) so we can reject the null hypothesis that all regression coefficients are equal to zero. The amount of variance in <code>price_ln</code> explained by the model is equal to 96.6. It seems likely that prices of diamonds will be much easier to predict than demand for diamonds.</p>
<p>The null and alternate hypothesis for the F-test can be formulated as follows: H0: All regression coefficients are equal to 0 Ha: At least one regression coefficient is not equal to zero</p>
<p>The coefficients from the regression can be interpreted as follows:</p>
<ul>
<li>For a 1% increase in carats we expect, on average, to see a 1.809% increase in the price of a diamond of, keeping all other variables in the model constant</li>
<li>Compared to a diamond of clarity I1 we expect, on average, to pay 100x(exp(.444)-1) = 55.89% more for a diamond of clarity SI2, keeping all other variables in the model constant</li>
<li>Compared to a diamond of clarity I1 we expect, on average, to pay 100x(exp(.591)-1) = 80.58% more for a diamond of clarity SI1, keeping all other variables in the model constant</li>
<li>Compared to a diamond of clarity I1 we expect, on average, to pay 100x(exp(1.080)-1) = 194.47% more for a diamond of clarity IF, keeping all other variables in the model constant</li>
</ul>
<p>The coefficients for each of the levels of clarity imply that an increase in <code>clarity</code> will increase the price of diamond. Why then did the scatter plot of clarity versus (log) price show price decreasing with clarity? The difference is that in a regression we can determine the effect of a change in one variable (e.g., clarity) keeping all other variables in the model constant (i.e., carat). Bigger, heavier, diamonds are more likely to have flaws compared to small diamonds so when we look at the scatter plot we are really seeing the effect of not only improving clarity on price but also the effect of carats which are negatively correlated with clarity. In a regression, we can compare the effects of different levels of clarity on (log) price for a diamond of <strong>the same size</strong> (i.e., keeping carat constant). Without (log) carat in the model the estimated effect of clarity would be incorrect due to <a href="http://en.wikipedia.org/wiki/Omitted-variable_bias" target="_blank">omitted variable bias</a>. In fact, from a regression of <code>price_ln</code> on <code>clarity</code> we would conclude that a diamond of the highest clarity in the data (IF) would cost 59.22% less compared to a diamond of the lowest clarity (I1). Clearly this is not a sensible conclusion.</p>
<p>For each of the explanatory variables the following null and alternate hypotheses can be formulated: H0: The coefficient associated with explanatory variable X is equal to 0 Ha: The coefficient associated with explanatory variable X is not equal to 0</p>
<p>All coefficients in this regression are highly significant.</p>
<p align="center">
<img src="figures_model/regress_log_diamonds_summary.png">
</p>
</div>
<div id="report-rmd" class="section level3">
<h3>Report &gt; Rmd</h3>
<p>Add code to <a href="https://radiant-rstats.github.io/docs/data/report_rmd.html" target="_blank"><em>Report &gt; Rmd</em></a> to (re)create the analysis by clicking the <i title="report results" class="fa fa-edit"></i> icon on the bottom left of your screen or by pressing <code>ALT-enter</code> on your keyboard.</p>
<p>If a plot was created it can be customized using <code>ggplot2</code> commands or with <code>gridExtra</code>. See example below and <a href="https://radiant-rstats.github.io/docs/data/visualize.html" target="_blank"><em>Data &gt; Visualize</em></a> for details.</p>
<pre class="r"><code>result &lt;- regress(diamonds, rvar = &quot;price&quot;, evar = c(&quot;carat&quot;, &quot;clarity&quot;, &quot;cut&quot;, &quot;color&quot;))
summary(result)
plot(result, plots = &quot;scatter&quot;, custom = TRUE) %&gt;% 
  gridExtra::grid.arrange(grobs = ., top = &quot;Scatter plots&quot;, ncol = 2)</code></pre>
</div>
<div id="technical-notes" class="section level3">
<h3>Technical notes</h3>
<div id="coefficient-interpretation-for-a-linear-model" class="section level4">
<h4>Coefficient interpretation for a linear model</h4>
<p>To illustrate the interpretation of coefficients in a regression model we start with the following equation:</p>
<p><span class="math display">\[
  S_t = a + b P_t + c D_t + \epsilon_t
\]</span></p>
<p>where <span class="math inline">\(S_t\)</span> is sales in units at time <span class="math inline">\(t\)</span>, <span class="math inline">\(P_t\)</span> is the price in $ at time <span class="math inline">\(t\)</span>, <span class="math inline">\(D_t\)</span> is a dummy variable that indicates if a product is on display in a given week, and <span class="math inline">\(\epsilon_t\)</span> is the error term.</p>
<p>For a continuous variable such as price we can determine the effect of a $1 change, while keeping all other variables in the model constant, by taking the partial derivative of the sales equation with respect to <span class="math inline">\(P\)</span>.</p>
<p><span class="math display">\[
  \frac{ \partial S_t }{ \partial P_t } = b
\]</span></p>
<p>So <span class="math inline">\(b\)</span> is the marginal effect on sales of a $1 change in price. Because a dummy variable such as <span class="math inline">\(D\)</span> is not continuous we cannot use differentiation and the approach needed to determine the marginal effect is a little different. If we compare sales levels when <span class="math inline">\(D = 1\)</span> to sales levels when <span class="math inline">\(D = 0\)</span> we see that</p>
<p><span class="math display">\[
  a + b P_t + c \times 1 - a + b P_t + c \times 0 = c
\]</span></p>
<p>For a linear model <span class="math inline">\(c\)</span> is the marginal effect on sales when the product is on display.</p>
</div>
<div id="coefficient-interpretation-for-a-semi-log-model" class="section level4">
<h4>Coefficient interpretation for a semi-log model</h4>
<p>To illustrate the interpretation of coefficients in a semi-log regression model we start with the following equation:</p>
<p><span class="math display">\[
  ln S_t = a + b P_t + c D_t + \epsilon_t
\]</span></p>
<p>where <span class="math inline">\(ln S_t\)</span> is the (natural) log of sales at time <span class="math inline">\(t\)</span>. For a continuous variable such as price we can again determine the effect of a small change (e.g., $1 for a $100 dollar product), while keeping all other variables in the model constant, by taking the partial derivative of the sales equation with respect to <span class="math inline">\(P\)</span>. For the left-hand side of the equation we can use the chain-rule to get</p>
<p><span class="math display">\[
  \frac {\partial ln S_t}{\partial P_t} = \frac{1}{S_t} \frac{\partial S_t}{\partial P_t}
\]</span></p>
<p>In words, the derivative of the natural logarithm of a variable is the reciprocal of that variable, times the derivative of that variable. From the discussion on the linear model above we know that</p>
<p><span class="math display">\[
  \frac{ \partial a + b P_t + c D_t}{ \partial P_t } = b
\]</span></p>
<p>Combining these two equations gives</p>
<p><span class="math display">\[
  \frac {1}{S_t} \frac{\partial S_t}{\partial P_t} = b \; \text{or} \; \frac {\Delta S_t}{S_t} \approx b
\]</span></p>
<p>So a $1 change in price leads to a <span class="math inline">\(100 \times b\%\)</span> change in sales. Note that this approximation is only appropriate for small changes in the explanatory variable and may be affected by the scaling used (e.g., price in cents, dollars, or 1,000s of dollars). The approach outlined below for dummy variables is more general and can also be applied to continuous variables.</p>
<p>Because a dummy variable such as <span class="math inline">\(D\)</span> is not continuous we cannot use differentiation and will again compare sales levels when <span class="math inline">\(D = 1\)</span> to sales levels when <span class="math inline">\(D = 0\)</span> to get <span class="math inline">\(\frac {\Delta S_t}{S_t}\)</span>. To get <span class="math inline">\(S_t\)</span> rather than <span class="math inline">\(ln S_t\)</span> on the left hand side we take the exponent of both sides. This gives <span class="math inline">\(S_t = e^{a + b P_t + c D_t}\)</span>. The percentage change in <span class="math inline">\(S_t\)</span> when <span class="math inline">\(D_t\)</span> changes from 0 to 1 is then given by:</p>
<p><span class="math display">\[
  \begin{aligned}
  \frac {\Delta S_t}{S_t} &amp;\approx \frac{ e^{a + b P_t + c\times 1} - e^{a + b P_t + c \times 0} } {e^{a + b P_t + c \times 0} }\\
  &amp;= \frac{ e^{a + b P_t} e^c - e^{a + b P_t} }{ e^{a + b P_t} }\\
  &amp;= e^c - 1
  \end{aligned}
\]</span></p>
<p>For the semi-log model <span class="math inline">\(100 \times\:(exp(c)-1)\)</span> is the percentage change in sales when the product is on display. Similarly, for a $10 increase in price we would expect a <span class="math inline">\(100 \times\:(exp(b \times 10)-1)\)</span> increase in sales, keeping other variables constant.</p>
</div>
<div id="coefficient-interpretation-for-a-log-log-model" class="section level4">
<h4>Coefficient interpretation for a log-log model</h4>
<p>To illustrate the interpretation of coefficients in a log-log regression model we start with the following equation:</p>
<p><span class="math display">\[
  ln S_t = a + b ln P_t + \epsilon_t
\]</span></p>
<p>where <span class="math inline">\(ln P_t\)</span> is the (natural) log of sales at time <span class="math inline">\(t\)</span>. Ignoring the error term for simplicity we can rewrite this model in its multiplicative form by taking the exponent on both sides:</p>
<p><span class="math display">\[
  \begin{aligned}
  S_t &amp;= e^a + e^{b ln P_t}\\
  S_t &amp;= a^* P^b_t
  \end{aligned}
\]</span></p>
<p>where <span class="math inline">\(a^* = e^a\)</span> For a continuous variable such as price we can again take the partial derivative of the sales equation with respect to <span class="math inline">\(P_t\)</span> to get the marginal effect.</p>
<p><span class="math display">\[
  \begin{aligned}
  \frac{\partial S_t}{\partial P_t} &amp;= b a^* P^{b-1}_t\\
  &amp;= b S_t P^{-1}_t\\
  &amp;= b \frac{S_t}{P_t}
  \end{aligned}
\]</span></p>
<p>The general formula for an elasticity is <span class="math inline">\(\frac{\partial S_t}{\partial P_t} \frac{P_t}{S_t}\)</span>. Adding this information to the equation above we see that the coefficient <span class="math inline">\(b\)</span> estimated from a log-log regression can be directly interpreted as an elasticity:</p>
<p><span class="math display">\[
  \frac{\partial S_t}{\partial P_t} \frac{P_t}{S_t} = b \frac{S_t}{P_t} \frac{P_t}{S_t} = b
\]</span></p>
<p>So a 1% change in price leads to a <span class="math inline">\(b\)</span>% change in sales.</p>
</div>
</div>


&copy; Vincent Nijs (2018) <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img alt="Creative Commons License" style="border-width: 0" src="/docs/images/by-nc-sa.png"/></a>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>

<!-- mathjax -->
<!-- <script type='text/javascript' src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script> -->

<script>

  // manage active state of menu based on current page
  $(document).ready(function () {

      // active menu
      href = window.location.pathname
      href = href.substr(href.lastIndexOf('/') + 1)
      $('a[href="' + href + '"]').parent().addClass('active');

      // manage active menu header
      if (href.startsWith('authoring_'))
        $('a[href="' + 'authoring' + '"]').parent().addClass('active');
      else if (href.endsWith('_format.html'))
        $('a[href="' + 'formats' + '"]').parent().addClass('active');
      else if (href.startsWith('developer_'))
        $('a[href="' + 'developer' + '"]').parent().addClass('active');

  });

  // Google analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61296577-2', 'auto');
  ga('send', 'pageview');

</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
